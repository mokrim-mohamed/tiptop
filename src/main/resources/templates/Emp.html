<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Rechercher les Gains</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container">
        <h2 class="mt-5">Recherche de Gains par Email</h2>

        <!-- Formulaire de recherche -->
        <form id="searchForm" class="mb-4">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" class="form-control" id="email" placeholder="Entrez l'email" required>
            </div>
            <button type="submit" class="btn btn-primary">Rechercher</button>
        </form>

        <!-- Zone d'affichage des résultats -->
        <div id="results" class="mt-3">
            <div id="errorMessage" class="alert alert-danger" style="display:none;"></div>

            <table id="gainsTable" class="table table-bordered" style="display:none;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Code</th>
                        <th>Actions</th> <!-- Nouvelle colonne pour les boutons -->
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $("#searchForm").submit(function(event) {
                event.preventDefault(); // Empêche le rechargement de la page

                var email = $("#email").val();

                $.ajax({
                    url: "/getUserGains",
                    type: "POST",
                    data: { email: email },
                    success: function(gains) {
                        console.log(gains); // Vérifiez les données ici
                        $("#errorMessage").hide();
                        $("#gainsTable").show();
                        $("#gainsTable tbody").empty();

                        gains.forEach(function(gain) {
                            // Création d'un bouton cliquable si remis est false
                            var button = gain.remis ? 
                                "<button class='btn btn-secondary' disabled>Non Cliquable</button>" : 
                                "<button class='btn btn-success' onclick='handleRemis(" + gain.id + ")'>Cliquable</button>";

                            $("#gainsTable tbody").append(
                                "<tr>" +
                                "<td>" + gain.id + "</td>" +
                                "<td>" + gain.code + "</td>" +
                                "<td>" + button + "</td>" + // Ajout de la colonne avec le bouton
                                "</tr>"
                            );
                        });
                    },
                    error: function(xhr) {
                        $("#gainsTable").hide();
                        var message = "Erreur : " + xhr.responseText;
                        $("#errorMessage").text(message).show();
                    }
                });
            });
        });

        // Fonction pour gérer le clic sur le bouton
        function handleRemis(gainId) {
            // Ajoutez ici la logique que vous souhaitez exécuter lorsque le bouton est cliqué
            alert("Gain ID " + gainId + " a été cliqué !");
        }
    </script>
</body>
</html>
